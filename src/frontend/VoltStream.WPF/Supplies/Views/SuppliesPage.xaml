<Page x:Class="VoltStream.WPF.Supplies.Views.SuppliesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:VoltStream.WPF.Supplies.Views"
      xmlns:controls="clr-namespace:VoltStream.WPF.Commons.UserControls"
      xmlns:utils="clr-namespace:VoltStream.WPF.Commons.Utils"
      xmlns:conv="clr-namespace:VoltStream.WPF.Commons.Converters"
      mc:Ignorable="d"
      d:DesignHeight="450"
      d:DesignWidth="800"
      Title="SupplyPage">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:UtcToUzbekistanTimeConverter x:Key="UtcToUzbekistanTimeConverter" />
    </Page.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="175" />
            <RowDefinition Height="*" />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*"
                                  MaxWidth="600" />
                <ColumnDefinition Width="20" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid Grid.Column="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="35" />
                </Grid.RowDefinitions>
                <Grid  Grid.Row="0"
                       Grid.Column="0">
                    <StackPanel Orientation="Horizontal"
                                Margin="10,0">
                        <Label Content="Sana:"
                               VerticalAlignment="Center"
                               FontSize="14" />
                    </StackPanel>
                </Grid>

                <Grid Grid.Row="0" Grid.Column="1">

					<Grid.ColumnDefinitions>
						<ColumnDefinition/>
						<ColumnDefinition/>
					</Grid.ColumnDefinitions>

					<controls:UserCalendar x:Name="date"
                                           SelectedDate="{Binding SelectedDate, Mode=TwoWay}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Left"
                                           Width="150"
                                           FontSize="14"
                                           Margin="0,0,10,0"
                                            />
				</Grid>
                

				<Grid Grid.Row="1"
                      Grid.Column="0">
                    <StackPanel Orientation="Horizontal"
                                Margin="10,0">
                        <Label Content="Maxsulot:"
                               VerticalAlignment="Center"
                               FontSize="14" />
                    </StackPanel>
                </Grid>
                <Grid Grid.Row="1"
                      Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="75*" />
                        <ColumnDefinition Width="109*" />
                        <ColumnDefinition Width="184*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Turi"
                               VerticalAlignment="Center"
                               Foreground="#888"
                               Margin="10,0,10,0"
                               IsHitTestVisible="False"
                               Panel.ZIndex="1"
                               Visibility="{Binding ElementName=cbxCategory, Path=Text.IsEmpty, Converter={StaticResource BooleanToVisibilityConverter}}"
                               Grid.ColumnSpan="2" />

                    <ComboBox x:Name="cbxCategory"
                              IsEditable="True"
                              StaysOpenOnEdit="True"
                              Margin="0,0,10,0"
                              ItemsSource="{Binding Categories}"
                              SelectedItem="{Binding SelectedCategory}"
                              Text="{Binding CategoryText, UpdateSourceTrigger=LostFocus}"
                              DisplayMemberPath="Name"
                              VerticalAlignment="Center"
                              FontSize="14"
                              Grid.ColumnSpan="2" />

                    <TextBlock Grid.Column="2"
                               Text="Nomi"
                               VerticalAlignment="Center"
                               Foreground="#888"
                               Margin="10,0,10,0"
                               IsHitTestVisible="False"
                               Panel.ZIndex="1"
                               Visibility="{Binding ElementName=cbxProduct,Path=Text.IsEmpty,Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <ComboBox x:Name="cbxProduct"
                              Grid.Column="2"
                              IsEditable="True"
                              ItemsSource="{Binding Products}"
                              SelectedItem="{Binding SelectedProduct}"
                              Text="{Binding ProductText, UpdateSourceTrigger=LostFocus}"
                              DisplayMemberPath="Name"
                              VerticalAlignment="Center"
                              FontSize="14"
                              Margin="0,0,10,0"/>
                </Grid>
                <Grid Grid.Row="2"
                      Grid.Column="0">
                    <Label Content="To'plamda:"
                           VerticalAlignment="Center"
                           Margin="10,0"
                           FontSize="14" />
                </Grid>
                <Grid Grid.Row="2"
                      Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="85" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             x:Name="tbxPerRollCount"
                             utils:NumericInput.Value="{Binding PerRollCount, UpdateSourceTrigger=PropertyChanged}"
                             utils:NumericInput.Precision="2"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Right"
                             FontSize="14"
                             Validation.ErrorTemplate="{x:Null}"
                             Margin="0,0,10,0"
                             utils:NumericInput.IsNumeric="True"
                              />

                    <TextBlock Grid.Column="1"
                               Text="To'plam soni:"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"
                               FontSize="14"
                               Margin="0,0,5,0" />
                    <TextBox Grid.Column="2"
                             x:Name="tbxRollCount"
                             utils:NumericInput.Value="{Binding RollCount, UpdateSourceTrigger=PropertyChanged}"
                             utils:NumericInput.Precision="0"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Stretch"
                             Validation.ErrorTemplate="{x:Null}"    
                             HorizontalContentAlignment="Right"
                             FontSize="14"
                             Margin="0,0,10,0"
                             utils:NumericInput.IsNumeric="True"
                              />
                </Grid>
                <Grid Grid.Row="3"
                      Grid.Column="0">
                    <Label Content="Jami:"
                           VerticalAlignment="Center"
                           Margin="10,0"
                           FontSize="14" />
                </Grid>
                <Grid Grid.Row="3"
                      Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="85" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             x:Name="totalMeters"
                             utils:NumericInput.Value="{Binding TotalQuantity, UpdateSourceTrigger=PropertyChanged}"
                             utils:NumericInput.Precision="2"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Right"
                             FontSize="14"
                             Margin="0,0,10,0"
                             Validation.ErrorTemplate="{x:Null}"
                             utils:NumericInput.IsNumeric="True"
                             IsTabStop="False"
                             IsReadOnly="True" />
                    <Label Grid.Column="1"
                           Content="O'lcho'vi:"
                           VerticalAlignment="Center"
                           Margin="10,0"
                           FontSize="14" />
                    <ComboBox Grid.Column="2"
                              x:Name="cbxUnit"
                              Text="{Binding Unit, UpdateSourceTrigger=PropertyChanged}"
                              StaysOpenOnEdit="True"
                              Margin="0,0,10,0"
                          VerticalAlignment="Center"
                          FontSize="14"
                          >
                        <ComboBoxItem >metr</ComboBoxItem>
                        <ComboBoxItem >dona</ComboBoxItem>
                    </ComboBox>

                </Grid>
                <Grid Grid.Row="4"
                      Grid.Column="0">
                    <Label Content="Narxi:"
                           VerticalAlignment="Center"
                           Margin="10,0"
                           FontSize="14" />
                </Grid>

                <Grid Grid.Row="4"
                      Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="85" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" 
                             x:Name="txtUnitPrice"
                             utils:NumericInput.Value="{Binding UnitPrice, UpdateSourceTrigger=PropertyChanged}"
                             utils:NumericInput.IsNumeric="True"
                             utils:NumericInput.Precision="2"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Right"
                             FontSize="14"
                             Validation.ErrorTemplate="{x:Null}"
                             Margin="0,0,10,0"       
                              />
                    <Label Grid.Column="1"
                           Content="Chegirma: %"
                           VerticalAlignment="Center"
                           FontSize="14"
                           Margin="-10,0,0,0" />
                    <TextBox Grid.Column="2"
                             x:Name="tbxDiscountRate"
                             utils:NumericInput.Value="{Binding DiscountRate, UpdateSourceTrigger=PropertyChanged}"
                             utils:NumericInput.Precision="2"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Stretch"
                             HorizontalContentAlignment="Right"
                             FontSize="14"
                             Margin="0,0,10,0"
                             Validation.ErrorTemplate="{x:Null}"
                             utils:NumericInput.IsNumeric="True"
                             />
                </Grid>
                <Grid Grid.Row="5" Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <Button Grid.Column="0"
                            x:Name="addSupplyBtn"
                            Content="{Binding IsEditing, Converter={StaticResource BoolToTextConverter}, ConverterParameter=' Saqlash  ðŸ’¾ | Qoshish  ðŸ—¹ '}"
                            Command="{Binding SaveCommand}"
                            VerticalAlignment="Center"
                            FontWeight="DemiBold"
                            Margin="2,4,10,4"
                            FontSize="14"
                            Height="27" />

                    <Button Grid.Column="1"
                            x:Name="cancelBtn"
                            Content=" Bekor qilish âŒ "
                            Command="{Binding CancelEditCommand}"
                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                            VerticalAlignment="Center"
                            FontWeight="DemiBold"
                            Margin="2,4,10,4"
                            FontSize="14"
                            Height="27" />
                </Grid>
            </Grid>
            <Grid Grid.Column="2">
                <Border BorderBrush="Gray"
                        BorderThickness="1"
                        Margin="10">
                    <Label Content="Mahsulot haqida ma'lumotlar.."
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="16"
                           FontWeight="Thin"
                           Foreground="LightGray"/>
                </Border>
            </Grid>
        </Grid>
        <DataGrid Grid.Row="1"
                  x:Name="supplyDataGrid"
                  ItemsSource="{Binding Supplies}"
                  SelectedItem="{Binding SelectedSupply}"
                  HorizontalAlignment="Center"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  CanUserAddRows="False"
                  HeadersVisibility="Column, Row"
                  utils:DataGridRowNumbering.IsEnabled="True"
                  Margin="10"
                  Foreground="Black">
            <DataGrid.InputBindings>
                <MouseBinding Gesture="LeftDoubleClick" Command="{Binding EditItemCommand}" CommandParameter="{Binding SelectedSupply}" />
                <KeyBinding Key="Delete" Command="{Binding DeleteItemCommand}" CommandParameter="{Binding SelectedSupply}" />
            </DataGrid.InputBindings>
            <DataGrid.Columns>
                <DataGridTextColumn Header="Sana"
                                    Width="*"
                                    Binding="{Binding Date, Converter={StaticResource UtcToUzbekistanTimeConverter},StringFormat=dd.MM.yyyy}">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="HorizontalAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Mahsulot turi"
                                    Binding="{Binding CategoryName}"
                                    Width="1.5*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="Padding"
                                    Value="10 0 5 0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Mahsulot"
                                    Binding="{Binding ProductName}"
                                    Width="2*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="Padding"
                                    Value="10 0 5 0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="To'plam soni"
                                    Binding="{Binding RollCount, StringFormat=N2}"
                                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="HorizontalAlignment"
                                    Value="Right" />
                            <Setter Property="Padding"
                                    Value="10 0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="To'plamda"
                                    Binding="{Binding LengthPerRoll, StringFormat=N2}"
                                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="HorizontalAlignment"
                                    Value="Center" />
                            <Setter Property="HorizontalAlignment"
                                    Value="Right" />
                            <Setter Property="Padding"
                                    Value="10 0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Jami"
                                    Binding="{Binding TotalLength, StringFormat=N2}"
                                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="Black" />
                            <Setter Property="HorizontalAlignment"
                                    Value="Right" />
                            <Setter Property="Padding"
                                    Value="10 0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
